/*
yhat-digits-prediction - v0.0.1 - 2013-10-25
Guesses what digit your writing in real time.
Lovingly coded by yhat  - http://yhathq.com 
*/
window.addEventListener&&window.addEventListener("load",function(){function a(){if(f=document.getElementById("imageView"),!f)return alert("Error: I cannot find the canvas element!"),void 0;if(!f.getContext)return alert("Error: no canvas.getContext!"),void 0;if(g=f.getContext("2d"),!g)return alert("Error: failed to getContext!"),void 0;var a=f.parentNode;if(d=document.createElement("canvas"),!d)return alert("Error: I cannot create a new canvas element!"),void 0;d.id="imageTemp",d.width=f.width,d.height=f.height,a.appendChild(d),e=d.getContext("2d"),e.fillStyle="white",e.fillRect(0,0,500,500);var c="pencil";return c?(j[i]&&(h=new j[i],c.value=i),d.addEventListener("mousedown",b,!1),d.addEventListener("mousemove",b,!1),d.addEventListener("mouseup",b,!1),void 0):(alert("Error: failed to get the dtool element!"),void 0)}function b(a){makePrediction(),a.layerX||0==a.layerX?(a._x=a.layerX,a._y=a.layerY):(a.offsetX||0==a.offsetX)&&(a._x=a.offsetX,a._y=a.offsetY);var b=h[a.type];b&&b(a)}function c(){g.drawImage(d,0,0),e.clearRect(0,0,d.width,d.height)}var d,e,f,g,h,i="pencil",j={};j.pencil=function(){var a=this;this.started=!1,e.lineWidth=10,this.mousedown=function(b){e.beginPath(),e.moveTo(b._x,b._y),a.started=!0},this.mousemove=function(b){a.started&&(e.lineTo(b._x,b._y),e.stroke())},this.mouseup=function(b){a.started&&(a.mousemove(b),a.started=!1,c())}},j.rect=function(){var a=this;this.started=!1,this.mousedown=function(b){a.started=!0,a.x0=b._x,a.y0=b._y},this.mousemove=function(b){if(a.started){var c=Math.min(b._x,a.x0),f=Math.min(b._y,a.y0),g=Math.abs(b._x-a.x0),h=Math.abs(b._y-a.y0);e.clearRect(0,0,d.width,d.height),g&&h&&e.strokeRect(c,f,g,h)}},this.mouseup=function(b){a.started&&(a.mousemove(b),a.started=!1,c())}},j.line=function(){var a=this;this.started=!1,this.mousedown=function(b){a.started=!0,a.x0=b._x,a.y0=b._y},this.mousemove=function(b){a.started&&(e.clearRect(0,0,d.width,d.height),e.beginPath(),e.moveTo(a.x0,a.y0),e.lineTo(b._x,b._y),e.stroke(),e.closePath())},this.mouseup=function(b){a.started&&(a.mousemove(b),a.started=!1,c())}},a()},!1);var canvas=document.getElementById("imageView"),context=canvas.getContext("2d"),n=Math.floor(10*Math.random()),ws=new WebSocket("ws://starphleet-aa02a554-1981699582.us-west-1.elb.amazonaws.com/models/digitRecognizer/"),lastPred="";makePrediction=function(){var a=canvas.toDataURL().replace(/^data:image\/\w+;base64,/,"");lastPred=a,ws.send(JSON.stringify({image_string:a}))};var colorArray=["#A6CEE3","#1F78B4","#B2DF8A","#33A02C","#FB9A99","#E31A1C","#FDBF6F","#FF7F00","#CAB2D6","#6A3D9A"],offsets=[],app={resizingTimeout:null,init:function(){this.clearCanvas(),this.createOffsets(),this.update_points_test(),$(".num").text(n),$("#clear").on("click",function(){app.clearCanvas()}),$(window).resize(function(){clearTimeout(app.resizingTimeout),app.resizingTimeout=setTimeout(app.createOffsets,500)})},clearCanvas:function(){context.fillStyle="white",context.fillRect(0,0,500,500)},createOffsets:function(){offsets=[],$(".point span").each(function(){offsets.push($(this).offset().left-$(".container").offset().left)})},update_points_test:function(){var a=[1.345,2.24356,7,3.4356,9,9.3245,5.5,4.321,6.5431,8.345];$(".prediction").remove();var b=$(".point").width();for(i=0;10>i;i++){var c=a[i],d=Math.floor(c),e=c-d,f=offsets[d]+e*b-20;$(".number-line").append('<div class="prediction" data-prob="'+c+'" style="background:'+colorArray[i]+";left:"+f+"px;margin-top:"+5*i+'px"></div>')}}};ws.onmessage=function(a){var b=JSON.parse(a.data);$(".counter").text(parseInt($(".counter").text())+1),$(".prediction").remove();var c=$(".point").width();for(i=0;10>i;i++){var d=b.probs["prob_"+i],e=Math.floor(d),f=d-e,g=offsets[e]+f*c-20;$(".number-line").append('<div class="prediction" data-prob="'+d+'" style="background:'+colorArray[i]+";left:"+g+"px;margin-top:"+5*i+'px"></div>')}},$("document").ready(function(){app.init()});